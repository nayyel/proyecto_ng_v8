<div *ngIf="libroId && libroSeleccionado" style="text-align: center;">
  <div class="libro" style="background-color: rgb(204, 240, 204); border: 2px solid green;">
    <br><br>
    <img [src]="libroSeleccionado.link" [alt]="libroSeleccionado.titulo" class="libro-img">
    <h1 id="Titulo">{{ libroSeleccionado.titulo }}</h1>
    <p id="Autor"><b>Autor:</b> {{ libroSeleccionado.autor }}</p>
    <p id="Resumen"><b>Resumen:</b> {{ libroSeleccionado.resumen }}</p>
    <p id="Precio"><b>Precio:</b> {{ libroSeleccionado.precio }}€</p>
    <p id="Stock"><b>Stock:</b> {{ libroSeleccionado.stock }} unidades</p>
    <div>
      <p *ngIf="valoracionesLibro.length > 0">
        <strong>Valoración promedio:</strong>
        <span *ngFor="let _ of estrellasLlenas">⭐</span>
        <span *ngIf="mediaDecimal">✨</span>
        <span *ngFor="let _ of estrellasVacias">☆</span>
        ({{ averageRating.toFixed(2) }} / 5)
      </p>
      <p *ngIf="valoracionesLibro.length === 0">
        <strong>Valoración promedio:</strong> Sin valorar
      </p>
    </div>
    <button 
      style="background-color: blanchedalmond; color: rgb(1, 66, 1); border-radius: 15px; border-color: rgb(1, 66, 1);"
      (click)="agregarAlCarrito(libroSeleccionado)" 
      [ngClass]="{'disabled': libroSeleccionado.cantidad >= libroSeleccionado.stock}"
      [disabled]="libroSeleccionado.cantidad >= libroSeleccionado.stock">
      Agregar al carrito
    </button>
    <br><br>
  </div>

  <!-- Formulario de Valoración -->
  <div class="comentarios-container" style="margin-top: 30px; padding: 20px; border-top: 2px solid #ccc; text-align: left;">
    <h2>Deja tu valoración</h2>
  

  
    <label>Valoración:</label>
    <div>
      <ng-container *ngFor="let estrella of [0, 1, 2, 3, 4]">
        <input type="radio" [value]="estrella" name="valoracion" [(ngModel)]="nuevaValoracion.valoracion">
        {{ estrella }} ⭐
      </ng-container>
    </div>
    
    <label for="comentario">Comentario:</label>
    <textarea [(ngModel)]="nuevaValoracion.comentario" rows="5" style="width: 100%;" placeholder="Cuéntanos tu experiencia con el libro, artista..."></textarea>
    
    <br><br>
    
    <!-- Botones en línea -->
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
      <button 
        style="background-color: darkolivegreen; color: white; border-radius: 10px; padding: 10px 20px;"
        (click)="crearValoracion()">
        {{ tieneComentario ? 'Actualizar comentario' : 'Crear valoración' }}
      </button>
    
      <button 
        *ngIf="tieneComentario"
        style="background-color: #ff4444; color: white; border-radius: 10px; padding: 10px 20px;"
        (click)="borrarComentario()">
        Borrar mi comentario
      </button>
    </div>
    


  <!-- Lista de valoraciones -->
  <div *ngIf="valoracionesLibro.length > 0" style="margin-top: 40px;">
    <h3>Opiniones de otros lectores</h3>
    <div *ngFor="let val of valoracionesLibro" style="border-bottom: 1px solid #ccc; padding: 10px 0;">
      <p><strong>Usuario:</strong> {{ val.nombre_usuario }}</p>
      <p>
        <strong>Valoración:</strong>
        <span *ngFor="let estrella of [].constructor(val.Valoracion)">⭐</span>
        <span *ngFor="let vacia of [].constructor(5 - val.Valoracion)">☆</span>
      </p>
      <p><strong>Comentario:</strong> {{ val.Comentario || 'Sin comentario' }}</p>
    </div>
  </div>
</div>
